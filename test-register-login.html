<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…/ë¡œê·¸ì¸ ìë™ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        #test-results {
            margin: 2rem;
            padding: 1rem;
            background: #f0f0f0;
            border-radius: 8px;
        }
        .test-pass { color: green; font-weight: bold; }
        .test-fail { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div style="padding: 2rem;">
        <h1>íšŒì›ê°€ì…/ë¡œê·¸ì¸ ìë™ í…ŒìŠ¤íŠ¸</h1>
        <button onclick="runTests()" style="padding: 1rem 2rem; font-size: 1.2rem; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
            ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        </button>
        
        <div id="test-results"></div>
    </div>
    
    <script src="auth.js"></script>
    <script>
        const resultsDiv = document.getElementById('test-results');
        
        function log(message, isPass = true) {
            const p = document.createElement('p');
            p.className = isPass ? 'test-pass' : 'test-fail';
            p.textContent = (isPass ? 'âœ… ' : 'âŒ ') + message;
            resultsDiv.appendChild(p);
            console.log(message);
        }
        
        async function runTests() {
            resultsDiv.innerHTML = '<h2>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</h2>';
            
            try {
                // 1. FakeAuthDB í…ŒìŠ¤íŠ¸
                log('1. FakeAuthDB ì¡´ì¬ í™•ì¸');
                if (typeof FakeAuthDB === 'undefined') {
                    throw new Error('FakeAuthDBê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
                // 2. apiRequest í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
                log('2. apiRequest í•¨ìˆ˜ ì¡´ì¬ í™•ì¸');
                if (typeof apiRequest !== 'function') {
                    throw new Error('apiRequestê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
                // 3. ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„° ì´ˆê¸°í™”
                log('3. localStorage ì´ˆê¸°í™”');
                localStorage.clear();
                
                // 4. íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
                log('4. íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸ ì‹œì‘');
                const registerData = {
                    username: 'í…ŒìŠ¤íŠ¸ìœ ì €',
                    email: 'test@example.com',
                    phone: '010-1234-5678',
                    birthdate: '2000-01-01',
                    password: '12345678',
                    is_member: true
                };
                
                const registerResponse = await apiRequest('/api/register', 'POST', registerData);
                log('5. íšŒì›ê°€ì… ì„±ê³µ: ' + JSON.stringify(registerResponse));
                
                if (!registerResponse.token) {
                    throw new Error('í† í°ì´ ë°˜í™˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                log('6. í† í° ë°œê¸‰ í™•ì¸: ' + registerResponse.token.substring(0, 20) + '...');
                
                // 5. ë¡œê·¸ì•„ì›ƒ
                log('7. ë¡œê·¸ì•„ì›ƒ');
                AuthManager.removeToken();
                AuthManager.removeUser();
                
                // 6. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
                log('8. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                const loginData = {
                    email: 'test@example.com',
                    password: '12345678'
                };
                
                const loginResponse = await apiRequest('/api/login', 'POST', loginData);
                log('9. ë¡œê·¸ì¸ ì„±ê³µ: ' + JSON.stringify(loginResponse));
                
                if (!loginResponse.token) {
                    throw new Error('ë¡œê·¸ì¸ í† í°ì´ ë°˜í™˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                log('10. ë¡œê·¸ì¸ í† í° ë°œê¸‰ í™•ì¸');
                
                // 7. í† í° ì €ì¥ í…ŒìŠ¤íŠ¸
                log('11. í† í° ì €ì¥ í…ŒìŠ¤íŠ¸');
                AuthManager.setToken(loginResponse.token, true);
                
                if (!AuthManager.isLoggedIn()) {
                    throw new Error('ë¡œê·¸ì¸ ìƒíƒœê°€ ìœ ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                log('12. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í™•ì¸');
                
                // 8. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸
                log('13. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸');
                const userInfo = await apiRequest('/api/user/me', 'GET');
                log('14. ì‚¬ìš©ì ì •ë³´: ' + JSON.stringify(userInfo));
                
                // 9. ìµœì¢… ê²°ê³¼
                resultsDiv.innerHTML += '<h2 class="test-pass">ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!</h2>';
                log('âœ…âœ…âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
            } catch (error) {
                log('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, false);
                console.error(error);
                resultsDiv.innerHTML += '<h2 class="test-fail">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h2>';
            }
        }
    </script>
</body>
</html>
