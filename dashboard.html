<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µê³„ ëŒ€ì‹œë³´ë“œ - ì°ë¶€ë¶€ AI í”„ë¡¬í”„íŠ¸</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile-enhanced.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 0.5rem 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: #4caf50;
        }

        .stat-change.negative {
            color: #f44336;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-box {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-box h3 {
            margin: 0 0 1rem 0;
            color: #333;
        }

        .chart-canvas {
            max-height: 300px;
        }

        .top-prompts {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .top-prompts h3 {
            margin: 0 0 1rem 0;
            color: #333;
        }

        .prompt-rank-list {
            display: grid;
            gap: 1rem;
        }

        .prompt-rank-item {
            display: grid;
            grid-template-columns: 50px 1fr auto auto;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .prompt-rank-item:hover {
            background: #e8e8e8;
            transform: translateX(5px);
        }

        .rank-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            text-align: center;
        }

        .rank-number.top-1 {
            color: #ffd700;
        }

        .rank-number.top-2 {
            color: #c0c0c0;
        }

        .rank-number.top-3 {
            color: #cd7f32;
        }

        .rank-info h4 {
            margin: 0 0 0.25rem 0;
            color: #333;
        }

        .rank-meta {
            font-size: 0.85rem;
            color: #666;
        }

        .rank-sales {
            font-size: 1.25rem;
            font-weight: bold;
            color: #667eea;
        }

        .rank-count {
            font-size: 0.9rem;
            color: #666;
        }

        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .recent-activity h3 {
            margin: 0 0 1rem 0;
            color: #333;
        }

        .activity-list {
            display: grid;
            gap: 0.75rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .activity-icon {
            font-size: 1.5rem;
        }

        .activity-text {
            flex: 1;
            color: #666;
        }

        .activity-time {
            color: #999;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .prompt-rank-item {
                grid-template-columns: 40px 1fr;
                gap: 0.5rem;
            }

            .rank-sales, .rank-count {
                grid-column: 2;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <span class="logo-character" style="font-size: 2rem;">ğŸ’‘</span>
                <span class="logo-text">ì°ë¶€ë¶€ AI í”„ë¡¬í”„íŠ¸</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">í™ˆ</a>
                <a href="/community.html" class="nav-link">ì»¤ë®¤ë‹ˆí‹°</a>
                <a href="/dashboard.html" class="nav-link active">ëŒ€ì‹œë³´ë“œ</a>
                <button class="community-btn" onclick="location.href='/admin-login.html'">ê´€ë¦¬ì</button>
            </nav>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>ğŸ“Š ë¹„ì¦ˆë‹ˆìŠ¤ ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì‹¤ì‹œê°„ ë§¤ì¶œ ë° íšŒì› í†µê³„</p>
        </div>

        <div class="stats-overview">
            <div class="stat-box">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-value" id="todaySales">â‚©0</div>
                <div class="stat-label">ì˜¤ëŠ˜ ë§¤ì¶œ</div>
                <div class="stat-change positive" id="todaySalesChange">+0%</div>
            </div>

            <div class="stat-box">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-value" id="monthSales">â‚©0</div>
                <div class="stat-label">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
                <div class="stat-change positive" id="monthSalesChange">+0%</div>
            </div>

            <div class="stat-box">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-value" id="totalMembers">0</div>
                <div class="stat-label">ì „ì²´ íšŒì› ìˆ˜</div>
                <div class="stat-change positive" id="membersChange">+0ëª…</div>
            </div>

            <div class="stat-box">
                <div class="stat-icon">ğŸ“¦</div>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-label">ì´ ì£¼ë¬¸ ìˆ˜</div>
                <div class="stat-change positive" id="ordersChange">+0ê±´</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-box">
                <h3>ğŸ“… ìµœê·¼ 7ì¼ ë§¤ì¶œ ì¶”ì´</h3>
                <canvas id="salesChart" class="chart-canvas"></canvas>
            </div>

            <div class="chart-box">
                <h3>ğŸ‘¤ íšŒì› ìœ í˜•ë³„ ë¶„í¬</h3>
                <canvas id="membersChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <div class="top-prompts">
            <h3>ğŸ† ì¸ê¸° í”„ë¡¬í”„íŠ¸ TOP 5</h3>
            <div class="prompt-rank-list" id="topPromptsList">
                <div style="text-align: center; color: #999; padding: 2rem;">
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>

        <div class="recent-activity">
            <h3>âš¡ ìµœê·¼ í™œë™</h3>
            <div class="activity-list" id="activityList">
                <div style="text-align: center; color: #999; padding: 1rem;">
                    í™œë™ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        let salesChart = null;
        let membersChart = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login.html';
                return;
            }

            try {
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
                await loadDashboardData();
                
                // 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
                setInterval(loadDashboardData, 5000);
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        });

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        async function loadDashboardData() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('/api/admin/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateDashboard(data);
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard(data) {
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('todaySales').textContent = `â‚©${data.today_sales.toLocaleString()}`;
            document.getElementById('monthSales').textContent = `â‚©${data.month_sales.toLocaleString()}`;
            document.getElementById('totalMembers').textContent = data.total_members;
            document.getElementById('totalOrders').textContent = data.total_orders;

            // ë³€í™”ìœ¨ ì—…ë°ì´íŠ¸
            updateChange('todaySalesChange', data.today_sales_change);
            updateChange('monthSalesChange', data.month_sales_change);
            updateChange('membersChange', data.new_members_today, 'ëª…');
            updateChange('ordersChange', data.new_orders_today, 'ê±´');

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateSalesChart(data.sales_chart);
            updateMembersChart(data.members_chart);

            // ì¸ê¸° í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸
            updateTopPrompts(data.top_prompts);

            // ìµœê·¼ í™œë™ ì—…ë°ì´íŠ¸
            updateRecentActivity(data.recent_activity);
        }

        // ë³€í™”ìœ¨ ì—…ë°ì´íŠ¸
        function updateChange(elementId, value, suffix = '%') {
            const element = document.getElementById(elementId);
            const isPositive = value >= 0;
            
            element.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
            element.textContent = `${isPositive ? '+' : ''}${value}${suffix}`;
        }

        // ë§¤ì¶œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSalesChart(data) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            if (salesChart) {
                salesChart.destroy();
            }

            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'ë§¤ì¶œ (ì›)',
                        data: data.values,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'â‚©' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // íšŒì› ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateMembersChart(data) {
            const ctx = document.getElementById('membersChart').getContext('2d');
            
            if (membersChart) {
                membersChart.destroy();
            }

            membersChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#4facfe'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ì¸ê¸° í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸
        function updateTopPrompts(prompts) {
            const container = document.getElementById('topPromptsList');
            
            if (!prompts || prompts.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 2rem;">íŒë§¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = prompts.map((prompt, index) => {
                const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                return `
                    <div class="prompt-rank-item">
                        <div class="rank-number ${rankClass}">${index + 1}</div>
                        <div class="rank-info">
                            <h4>${prompt.title}</h4>
                            <div class="rank-meta">${prompt.category || 'í”„ë¡¬í”„íŠ¸'}</div>
                        </div>
                        <div class="rank-sales">â‚©${prompt.total_sales.toLocaleString()}</div>
                        <div class="rank-count">${prompt.order_count}ê±´</div>
                    </div>
                `;
            }).join('');
        }

        // ìµœê·¼ í™œë™ ì—…ë°ì´íŠ¸
        function updateRecentActivity(activities) {
            const container = document.getElementById('activityList');
            
            if (!activities || activities.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 1rem;">ìµœê·¼ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = activities.map(activity => {
                const icon = activity.type === 'purchase' ? 'ğŸ’³' : 
                            activity.type === 'signup' ? 'ğŸ‘¤' : 'ğŸ“';
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-text">${activity.text}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
