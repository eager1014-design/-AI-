<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ì°ë¶€ë¶€ ì»¤ë®¤ë‹ˆí‹° - ëª¨ë°”ì¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            padding-bottom: 70px;
        }
        
        /* ìƒë‹¨ í—¤ë” */
        .mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .mobile-header-title {
            font-size: 1.125rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        /* ì†Œëª¨ì„ ì—°ë™ ë°°ë„ˆ */
        .somoim-banner {
            margin-top: 60px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        .somoim-banner-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .somoim-sync-btn {
            background: white;
            color: #6366f1;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        /* íƒ­ ë©”ë‰´ */
        .tab-menu {
            position: sticky;
            top: 60px;
            background: white;
            display: flex;
            z-index: 999;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .tab-item {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: none;
            border: none;
            font-size: 0.9375rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-item.active {
            color: #d97706;
            border-bottom-color: #d97706;
            font-weight: 700;
        }
        
        /* ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ */
        .post-list {
            padding: 0.5rem;
        }
        
        .post-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .post-author-img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-right: 0.75rem;
        }
        
        .post-author-info {
            flex: 1;
        }
        
        .post-author-name {
            font-weight: 700;
            font-size: 0.9375rem;
            color: #1f2937;
        }
        
        .post-time {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .post-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .badge-somoim {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-notice {
            background: #fef3c7;
            color: #92400e;
        }
        
        .post-title {
            font-size: 1rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .post-content {
            font-size: 0.875rem;
            color: #4b5563;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }
        
        .post-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.8125rem;
            color: #6b7280;
        }
        
        /* í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-btn {
            position: fixed;
            bottom: 80px;
            right: 1rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            color: white;
            border: none;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.4);
            z-index: 998;
        }
        
        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0;
            border-top: 1px solid #e5e7eb;
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 0.75rem;
            padding: 0.5rem;
        }
        
        .nav-item.active {
            color: #d97706;
        }
        
        .nav-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 0.25rem;
        }
        
        /* ê¸€ì“°ê¸° ëª¨ë‹¬ */
        .write-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
        }
        
        .write-modal.active {
            display: block;
        }
        
        .write-header {
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .write-content {
            padding: 1rem;
        }
        
        .write-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .write-textarea {
            width: 100%;
            min-height: 200px;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9375rem;
            resize: vertical;
        }
        
        .write-submit {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="mobile-header">
        <div class="mobile-header-title">
            <span class="logo-emoji" style="font-size: 2.5rem;">ğŸ’‘</span>
            ì°ë¶€ë¶€ ì»¤ë®¤ë‹ˆí‹°
        </div>
        <button onclick="syncSomoim()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8125rem;         ğŸ”„ ì†Œëª¨ì„ ë™ê¸°í™”
        </button>
    </div>
    
    <!-- ì†Œëª¨ì„ ì—°ë™ ë°°ë„ˆ -->
    <div class="somoim-banner">
        <div class="somoim-banner-title">ğŸ“¢ ì†Œëª¨ì„ê³¼ ìë™ ì—°ë™ë©ë‹ˆë‹¤</div>
        <div style="font-size: 0.8125rem;">ì†Œëª¨ì„ ê³µì§€ì‚¬í•­ì´ ìë™ìœ¼ë¡œ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        <button class="somoim-sync-btn" onclick="openSomoimSettings()">ì—°ë™ ì„¤ì •</button>
    </div>
    
    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tab-menu">
        <button class="tab-item active" onclick="switchTab('all')">ì „ì²´</button>
        <button class="tab-item" onclick="switchTab('somoim')">ì†Œëª¨ì„</button>
        <button class="tab-item" onclick="switchTab('notice')">ê³µì§€</button>
        <button class="tab-item" onclick="switchTab('event')">ì •ëª¨</button>
    </div>
    
    <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
    <div class="post-list" id="postList">
        <!-- ìƒ˜í”Œ ê²Œì‹œê¸€ -->
        <div class="post-card" data-category="somoim">
            <div class="post-header">
                <span style="font-size: 2.5rem;">ğŸ’‘</span>
                <div class="post-author-info">
                    <div class="post-author-name">ì°ë¶€ë¶€ ê´€ë¦¬ì</div>
                    <div class="post-time">5ë¶„ ì „</div>
                </div>
                <span class="post-badge badge-somoim">ì†Œëª¨ì„</span>
            </div>
            <div class="post-title">ğŸ‰ ì†Œëª¨ì„ ë©¤ë²„ í™˜ì˜í•©ë‹ˆë‹¤!</div>
            <div class="post-content">
                ì†Œëª¨ì„ì—ì„œ ì˜¤ì‹  ëª¨ë“  ë¶„ë“¤ í™˜ì˜í•©ë‹ˆë‹¤! 
                AI í”„ë¡¬í”„íŠ¸ ê´€ë ¨ ì§ˆë¬¸ì´ë‚˜ ê³µìœ í•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ ìˆìœ¼ì‹œë©´ ììœ ë¡­ê²Œ ì˜¬ë ¤ì£¼ì„¸ìš”.
            </div>
            <div class="post-stats">
                <span>â¤ï¸ 23</span>
                <span>ğŸ’¬ 5</span>
                <span>ğŸ‘ï¸ 127</span>
            </div>
        </div>
        
        <div class="post-card" data-category="notice">
            <div class="post-header">
                <span style="font-size: 2.5rem;">ğŸ’‘</span>
                <div class="post-author-info">
                    <div class="post-author-name">ì°ë¶€ë¶€</div>
                    <div class="post-time">1ì‹œê°„ ì „</div>
                </div>
                <span class="post-badge badge-notice">ê³µì§€</span>
            </div>
            <div class="post-title">ğŸ“¢ íšŒì› í• ì¸ ì´ë²¤íŠ¸ ì§„í–‰ ì¤‘!</div>
            <div class="post-content">
                ê°€ì… í›„ 3ì‹œê°„ ë™ì•ˆ ì¶”ê°€ 50% í• ì¸! 
                í”„ë¡¬í”„íŠ¸ êµ¬ë§¤í•˜ê³  SNS ì„±ì¥ ì‹œì‘í•˜ì„¸ìš” ğŸš€
            </div>
            <div class="post-stats">
                <span>â¤ï¸ 45</span>
                <span>ğŸ’¬ 12</span>
                <span>ğŸ‘ï¸ 234</span>
            </div>
        </div>
        
        <div class="post-card" data-category="event">
            <div class="post-header">
                <span style="font-size: 2.5rem;">ğŸ’‘</span>
                <div class="post-author-info">
                    <div class="post-author-name">ì°ë¶€ë¶€ ì†Œëª¨ì„</div>
                    <div class="post-time">3ì‹œê°„ ì „</div>
                </div>
                <span class="post-badge badge-somoim">ì •ëª¨</span>
            </div>
            <div class="post-title">ğŸ½ï¸ ë‹¤ìŒ ì£¼ ì˜¤í”„ë¼ì¸ ì •ëª¨ ì•ˆë‚´</div>
            <div class="post-content">
                ì¼ì‹œ: 12ì›” 18ì¼ ì˜¤í›„ 7ì‹œ
                ì¥ì†Œ: ê°•ë‚¨ì—­ ê·¼ì²˜ ì¹´í˜
                ì£¼ì œ: AI í”„ë¡¬í”„íŠ¸ í™œìš© ë…¸í•˜ìš° ê³µìœ 
            </div>
            <div class="post-stats">
                <span>â¤ï¸ 67</span>
                <span>ğŸ’¬ 28</span>
                <span>ğŸ‘ï¸ 456</span>
            </div>
        </div>
    </div>
    
    <!-- í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <button class="floating-btn" onclick="openWriteModal()">âœï¸</button>
    
    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bottom-nav">
        <button class="nav-item" onclick="location.href='/'">
            <span class="nav-icon">ğŸ </span>
            í™ˆ
        </button>
        <button class="nav-item active">
            <span class="nav-icon">ğŸ’¬</span>
            ì»¤ë®¤ë‹ˆí‹°
        </button>
        <button class="nav-item" onclick="location.href='/somoim-test.html'">
            <span class="nav-icon">ğŸ‘¥</span>
            ì†Œëª¨ì„
        </button>
        <button class="nav-item" onclick="showMyPage()">
            <span class="nav-icon">ğŸ‘¤</span>
            MY
        </button>
    </div>
    
    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
    <div class="write-modal" id="writeModal">
        <div class="write-header">
            <button onclick="closeWriteModal()" style="background: none; border: none; color: white; font-size: 1rem;">âœ• ë‹«ê¸°</button>
            <span style="font-weight: 700;">ê¸€ì“°ê¸°</span>
            <div style="width: 50px;"></div>
        </div>
        <div class="write-content">
            <select class="write-input">
                <option>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                <option value="general">ììœ </option>
                <option value="question">ì§ˆë¬¸</option>
                <option value="share">ì •ë³´ê³µìœ </option>
                <option value="success">ì„±ê³µì‚¬ë¡€</option>
            </select>
            <input type="text" class="write-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" id="postTitle">
            <textarea class="write-textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" id="postContent"></textarea>
            <button class="write-submit" onclick="submitPost()">ê²Œì‹œí•˜ê¸°</button>
        </div>
    </div>
    
    <script>
        let currentTab = 'all';
        let allPosts = [];
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();
        });
        
        // ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° (ì¼ë°˜ + ì†Œëª¨ì„)
        async function loadPosts() {
            try {
                // ì¼ë°˜ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€
                const communityResponse = await fetch('/api/posts?per_page=50');
                const communityData = await communityResponse.json();
                
                // ì†Œëª¨ì„ ê²Œì‹œê¸€
                const somoimResponse = await fetch('/api/somoim/posts?per_page=50');
                const somoimData = await somoimResponse.json();
                
                // í†µí•© ë° ì •ë ¬
                allPosts = [
                    ...communityData.posts.map(p => ({...p, source: 'community'})),
                    ...somoimData.posts.map(p => ({...p, source: 'somoim'}))
                ].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                renderPosts();
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ê²Œì‹œê¸€ ë Œë”ë§
        function renderPosts() {
            const postList = document.getElementById('postList');
            
            // í˜„ì¬ íƒ­ì— ë§ëŠ” ê²Œì‹œê¸€ë§Œ í•„í„°ë§
            let filteredPosts = allPosts;
            if (currentTab === 'somoim') {
                filteredPosts = allPosts.filter(p => p.source === 'somoim');
            } else if (currentTab === 'notice') {
                filteredPosts = allPosts.filter(p => p.source === 'somoim' && p.post_type === 'notice');
            } else if (currentTab === 'event') {
                filteredPosts = allPosts.filter(p => p.source === 'somoim' && p.post_type === 'meeting');
            }
            
            postList.innerHTML = filteredPosts.map(post => createPostCard(post)).join('');
        }
        
        // ê²Œì‹œê¸€ ì¹´ë“œ ìƒì„±
        function createPostCard(post) {
            const issomoim = post.source === 'somoim';
            const badgeClass = issomoim ? 'badge-somoim' : 'badge-notice';
            const badgeText = issomoim ? 
                (post.post_type === 'notice' ? 'ê³µì§€' : post.post_type === 'meeting' ? 'ì •ëª¨' : 'ì†Œëª¨ì„') : 
                (post.category || 'ì¼ë°˜');
            
            const timeAgo = getTimeAgo(post.created_at);
            
            return `
                <div class="post-card" data-category="${issomoim ? post.post_type : 'general'}">
                    <div class="post-header">
                        <span style="font-size: 2.5rem;">ğŸ’‘</span>
                        <div class="post-author-info">
                            <div class="post-author-name">${post.author || post.username || 'ìµëª…'}</div>
                            <div class="post-time">${timeAgo}</div>
                        </div>
                        <span class="post-badge ${badgeClass}">${badgeText}</span>
                    </div>
                    <div class="post-title">${post.title}</div>
                    <div class="post-content">${truncateText(post.content, 100)}</div>
                    ${post.meeting_date ? `
                        <div class="post-content" style="color: #6366f1; font-weight: 600;">
                            ğŸ“… ${formatDate(post.meeting_date)}
                            ${post.meeting_location ? `<br>ğŸ“ ${post.meeting_location}` : ''}
                        </div>
                    ` : ''}
                    <div class="post-stats">
                        <span>â¤ï¸ ${post.likes || 0}</span>
                        <span>ğŸ’¬ ${post.comments_count || 0}</span>
                        <span>ğŸ‘ï¸ ${post.views || 0}</span>
                    </div>
                </div>
            `;
        }
        
        // ì‹œê°„ í‘œì‹œ (ì˜ˆ: 5ë¶„ ì „)
        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            if (seconds < 60) return 'ë°©ê¸ˆ ì „';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}ë¶„ ì „`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}ì‹œê°„ ì „`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)}ì¼ ì „`;
            return date.toLocaleDateString('ko-KR');
        }
        
        // í…ìŠ¤íŠ¸ ìë¥´ê¸°
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
        
        // ë‚ ì§œ í¬ë§·
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // íƒ­ ì „í™˜
        function switchTab(category) {
            currentTab = category;
            const tabs = document.querySelectorAll('.tab-item');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            renderPosts();
        }
        
        // ê¸€ì“°ê¸° ëª¨ë‹¬
        function openWriteModal() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                location.href = '/';
                return;
            }
            document.getElementById('writeModal').classList.add('active');
        }
        
        function closeWriteModal() {
            document.getElementById('writeModal').classList.remove('active');
        }
        
        // ê²Œì‹œê¸€ ì‘ì„±
        async function submitPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const category = document.querySelector('.write-input').value;
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const token = localStorage.getItem('auth_token');
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        category: category || 'ììœ '
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    closeWriteModal();
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    loadPosts();  // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert(data.message || 'ê²Œì‹œê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨:', error);
                alert('ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì†Œëª¨ì„ ë™ê¸°í™”
        async function syncSomoim() {
            try {
                await loadPosts();
                alert('ì†Œëª¨ì„ ê²Œì‹œíŒê³¼ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
            } catch (error) {
                alert('ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì†Œëª¨ì„ ì„¤ì •
        function openSomoimSettings() {
            alert('ì†Œëª¨ì„ ì—°ë™ ì„¤ì •\n\nâœ… ìë™ ê³µì§€ ë™ê¸°í™”\nâœ… ì •ëª¨ ì•Œë¦¼\nâœ… ë©¤ë²„ ì „ìš© ê²Œì‹œê¸€\n\nëª¨ë“  ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤!');
        }
        
        // ë§ˆì´í˜ì´ì§€
        function showMyPage() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                location.href = '/';
            } else {
                location.href = '/?showDashboard=true';
            }
        }
    </script>
</body>
</html>
';
            }
        }
    </script>
</body>
</html>
html>
